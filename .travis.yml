language: ruby
install: bundle install --clean --path=vendor/bundle --jobs=4
cache:
  directories:
    - vendor/bundle
    - sdk

rvm:
  - 2.3.7
  - 2.4.4
  - 2.5.1

script:
  - |
    version='4333796'
    if [ "$(cat sdk/.sdk_tools_version || echo)" != "$version" ]; then
      rm -fr sdk || :
      mkdir -p sdk/licenses
      curl -o sdk-tools-linux.zip "https://dl.google.com/android/repository/sdk-tools-linux-$version.zip"
      unzip "sdk-tools-linux.zip" -d sdk
    fi
    cp docker/licenses sdk/licenses/android-sdk-license
    yes | sdk/tools/bin/sdkmanager "build-tools;27.0.3"
  - |
    export ANDROID_HOME="$PWD/sdk"
    export PATH="$ANDROID_HOME/build-tools/27.0.3:$PATH"
    bundle exec rake spec